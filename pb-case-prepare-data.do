/*************************************************************************************************File        : pb-case-prepare-data.do  <--- this should be the exact name of THIS documentAuthor      : Kristina Tobio Created     : 02 Dec 2016Modified    : 10 Jan 2017Description : .do file for preparing data for use in pb-case-a.do, pb-case-b.do and pb-case-c.do *************************************************************************************************/// these commands prepare your computer for the data and analysis// this finds and closes open log filescapture log close        // this clears Stata's data memory so new data can be loadedclear       // this makes it so you don't have to keep pressing return/enter to scroll through resultsset more off          // this keeps everything visible on a normal monitor or laptop screenset linesize 200    // cd means "change directory"// changes to the current directory cd .// this creates a log file, which will record all of the commands and outputs from this .do file // log files should be placed in a folder named "logs" in your directory log using "logs/pb-case-prepare-data", replace// data should be placed in a folder named "data" in your directory // this pulls in the data in its exact Excel form from HBP// this command reads the data into Stataimport excel using "data/Pilgrim_ABC_Spreadsheet.xls", sheet(Data) firstrow // renaming variables to make them more user friendlyrename ID idrename Profit _9profitrename Online _9onlinerename Age _9agerename Inc _9increname Tenure _9tenurerename District _9districtrename H _0profitrename I _0onlinerename Billpay _9billpayrename K _0billpay// export data into a CSV file that can be easily imported into Stataexport delimited "data/pb-case-data.csv", replace// create a seperate dataset for Part A of case (and pb-case-a.do), which only uses the 1999 (prefix "_9") data and no _9billpaykeep id _9profit _9online _9age _9inc _9tenure _9districtexport delimited "data/pb-case-data-part-a.csv", replace// clear Stata memoryclear// create a seperate dataset for additional data for Part B of case (and pb-case-b.do), which adds the 200 (prefix "_0") data save the billpay variableinsheet using "data/pb-case-data.csv", nameskeep id _0profit _0online export delimited "data/pb-case-data-part-b.csv", replace// clear Stata memoryclear// create a seperate dataset for additional data for Part C of case (and pb-case-c.do), which adds the billpay variablesinsheet using "data/pb-case-data.csv", nameskeep id _9billpay _0billpayexport delimited "data/pb-case-data-part-c.csv", replace// clear Stata memoryclear// merging the three datasets together// Step 1: Save all CSV files as Stata data filesinsheet using "data/pb-case-data-part-a.csv", namessave "data/pb-case-data-part-a.dta", replaceclearinsheet using "data/pb-case-data-part-b.csv", namessave "data/pb-case-data-part-b.dta", replaceclearinsheet using "data/pb-case-data-part-c.csv", namessave "data/pb-case-data-part-c.dta", replaceclear// merge together one at a time// "id" is the common variable in all three datasetsuse "data/pb-case-data-part-a.dta"merge 1:1 id using "data/pb-case-data-part-b.dta"tab _merge// _merge should all equal "3" if it is successfuldrop _mergesave "data/pb-case-data-part-a-b.dta", replacemerge 1:1 id using "data/pb-case-data-part-c.dta"tab _merge// merge should all equal "3" if it is successfuldrop _mergesave "data/pb-case-data-part-a-b-c.dta", replace// closes your loglog close// drops all data from Stata's memoryclear