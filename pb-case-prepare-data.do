/*************************************************************************************************File        : pb-case-prepare-data.do  <--- this should be the exact name of THIS documentAuthor      : Kristina Tobio Created     : 02 Dec 2016Modified    : 19 Jan 2017Description : .do file for preparing data for use in pb-case-a.do, pb-case-b.do and pb-case-c.do *************************************************************************************************/// these commands prepare your computer for the data and analysis// this finds and closes open log filescapture log close        // this clears Stata's data memory so new data can be loadedclear       // this makes it so you don't have to keep pressing return/enter to scroll through resultsset more off          // this keeps everything visible on a normal monitor or laptop screenset linesize 200    // cd means "change directory"// changes to the current directory cd .// this creates a log file, which will record all of the commands and outputs from this .do file // log files should be placed in a folder named "logs" in your directory log using "logs/pb-case-prepare-data", replace// data should be placed in a folder named "data" in your directory // this pulls in the data in its exact Excel form from HBP// this command reads the data into Stataimport excel using "data/Pilgrim_ABC_Spreadsheet.xls", sheet(Data) firstrow // renaming variables to make them more user friendlyrename ID idrename Profit profit_99rename Online online_99rename Age age_99rename Inc income_99rename Tenure tenure_99rename District district_99rename H profit_00rename I online_00rename Billpay billpay_99rename K billpay_00// export data into a CSV file that can be easily imported into Stataexport delimited "data/PA_pilgrim_data.csv", replace// create a seperate dataset for Part A of case (and pb-case-a.do), which only uses the 1999 (prefix "_9") data and no _9billpaykeep id _9profit _9online _9age _9inc _9tenure _9districtexport delimited "data/PA_pilgrimA_data.csv", replace// clear Stata memoryclear// create a seperate dataset for additional data for Part B of case (and pb-case-b.do), which adds the 200 (prefix "_0") data save the billpay variableinsheet using "data/PA_pilgrim_data.csv", nameskeep id _0profit _0online export delimited "data/PA_pilgrimB_data.csv", replace// clear Stata memoryclear// create a seperate dataset for additional data for Part C of case (and pb-case-c.do), which adds the billpay variablesinsheet using "data/PA_pilgrim_data.csv", nameskeep id _9billpay _0billpayexport delimited "data/PA_pilgrimC_data.csv", replace// clear Stata memoryclear// merging the three datasets together// Step 1: Save all CSV files as Stata data filesinsheet using "data/PA_pilgrimA_data.csv", namessave "data/PA_pilgrimA_data.dta", replaceclearinsheet using "data/PA_pilgrimB_data.csv", namessave "data/PA_pilgrimB_data.dta", replaceclearinsheet using "data/PA_pilgrimC_data.csv", namessave "data/PA_pilgrimC_data.dta", replaceclear// merge together one at a time// "id" is the common variable in all three datasetsuse "data/PA_pilgrimA_data.dta"merge 1:1 id using "data/PA_pilgrimB_data.dta"tab _merge// _merge should all equal "3" if it is successfuldrop _mergesave "data/PA_pilgrim_data.dta", replacemerge 1:1 id using "data/PA_pilgrimC_data.dta"tab _merge// merge should all equal "3" if it is successfuldrop _mergesave "data/PA_pilgrim_data.dta", replace// closes your loglog close// drops all data from Stata's memoryclear